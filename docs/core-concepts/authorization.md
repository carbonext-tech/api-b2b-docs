---
sidebar_position: 1
custom_edit_url: null
---

# Authorization

Now that you have access to the system and have tested the basic functionality, let's move on to the use of M2M authorization (**machine to machine**) in which the authentication generated by the user and password allows access by other applications through access keys. .

## Authorize Client [POST]

```md title="BASE URL"
https://auth-hml.carbonext.com.br/auth/realms/co2free/protocol/openid-connect/token
```

This request validates the provided credentials and returns the generated token.

**Parameter Attributes**

| Parameter    | Description                         |
| ------------ | ----------------------------------- |
| client_id | The client's public credential key |
| client_secret | The client's private credential key |
| grant_type | client_credentials |

**Response Attributes**

| Parameter     | Description                                             |
| ------------- | ------------------------------------------------------- |
| accessToken | A token used to authorize user access. |
| token_type | The token type |
| expires_in | The amount of time until the token expires, numbers in seconds |
| refresh_token | The refresh token provided in the authorization request |

### Example Request

```javascript
var axios = require('axios');
var qs = require('qs');
var data = qs.stringify({
  'client_id': 'cbx_b2b_3fe7cbb3-212b-4591-acb3-009ca9e57ff7',
  'client_secret': '7beb0588-edb3-44f4-bbfc-9779cd5c9dbf',
  'grant_type': 'client_credentials',
  'scope': 'roles' 
});
var config = {
  method: 'post',
  url: 'https://auth-hml.carbonext.com.br/auth/realms/co2free/protocol/openid-connect/token',
  headers: { 
    'Content-Type': 'application/x-www-form-urlencoded'
  },
  data : data
};

axios(config)
.then(function (response) {
  console.log(JSON.stringify(response.data));
})
.catch(function (error) {
  console.log(error);
});
```

### Example Response

```json
{
  "access_token": "kRjvJJpQpwWHoWKi-K_5SO0w0dkAqiO2QudmyoJxlTI",
  "expires_in": 36000,
  "refresh_expires_in": 0,
  "token_type": "Bearer",
  "not-before-policy": 0,
  "scope": "profile email roles"
}
```

<!--
```md title="BODY urlencoded"
client_id: {{client_id}}
client_secret: {{client_secret}}
grant_type: client_credentials
scope: offline_access
```
 ## Refresh Token [POST]

```url title="BASE URL"
https://auth-hml.carbonext.com.br/auth/realms/co2free/protocol/openid-connect/token
```

This endpoint allows the user to request a new token when their current token expires.

**Parameter Attributes**

| Parameter     | Description                                              |
| ------------- | -------------------------------------------------------- |
| refresh_token | The refresh token provided in the authorization response |

### Example Request

```javascript
curl -X POST 'https://auth.carbonext.com.br/connect/token' \
--data-urlencode 'grant_type=refresh_token' \
--data-urlencode 'refresh_token={{refresh_token}}' \
--data-urlencode 'client_id={{client_id}}' \
--data-urlencode 'client_secret={{client_secret}}'
```

### Example Response

```json
{
  "access_token": "_OAiP7ySFVRf6_KE-8u9AcXjZQJQXhfRUkq_E0Zr1Mk",
  "token_type": "Bearer",
  "expires_in": 3595,
  "scope": "offline_access",
  "refresh_token": "5iI6Zo9QmJ3-bcmRTtH6ICdzjG-K2usMRKld0KrJRxw"
}
```

```md title="BODY urlencoded"
grant_type: refresh_token
refresh_token: {{refresh_token}}
client_id: {{client_id}}
client_secret: {{client_secret}}
``` -->

<!-- ## User Info [GET]

```url title="BASE URL"
https://auth.carbonext.com.br/connect/userinfo
```

A request that retrieves information from the user (or application key).

**Response Attributes**

| Attributes            | Description                                                            |
| --------------------- | ---------------------------------------------------------------------- |
| clientId              | The client identification (public key)                                 |
| userId                | The user identification                                                |
| name                  | The user's name                                                        |
| email                 | The user's email                                                       |
| isEmailValid          | A boolean to identify if the user's email has been verified            |
| customerId            | The ID of the customer the user or application is related to           |
| customerApplicationId | The ID of the customer's application (key)                             |
| customerTaxId         | The customer's tax document number                                     |
| customerLegalName     | The customer's legal name                                              |
| permissions           | An array containing the permissions keys for the user (or application) |

### Example Request

```javascript
curl -X GET 'https://auth.carbonext.com.br/connect/userinfo' \
    -H 'Content-Type: application/json' \
    -H 'Authorization: Bearer {token}'
```

### Example Response

```json
{
  "clientId": "5d7aac18-f566-49ec-b6cb-48e533d0d262",
  "userId": null,
  "name": null,
  "email": "exemplo.req@email.com",
  "isEmailValid": false,
  "customerId": "c892597a-997c-4a6f-a4cf-6e370240edff",
  "customerApplicationId": "ef04cbdc-5197-4812-a910-0d5253b4b2f5",
  "customerTaxId": "10.203.485/0001-74",
  "customerLegalName": "Carbon Teste",
  "permissions": [
    "certificates_read",
    "customerApplication_read",
    "customerApplication_write",
    "financial_read",
    "financial_write",
    "orders_read",
    "orders_write",
    "users_read",
    "users_write"
  ]
}
``` -->
